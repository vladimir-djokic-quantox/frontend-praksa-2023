---
import Header from "../../components/Header";
import BackToHomeButton from "../../components/BackButton";
import { formatPrice } from "../../utils/formatPrice";
import { addCartItem } from "../../utils/cartStore";
import ProductItem from "../../components/ProductItem";
import Footer from "../../components/Footer"


const { category } = Astro.params;
const response = await fetch(
  `https://dummyjson.com/products/category/${category}`
);
const data = await response.json();

const onAddToCart = (id, name, price, thumbnail) => {
  addCartItem({ id, name, price, thumbnail });
};
---
<div class="flex flex-col min-h-screen">
  <Header client:only="react" />
  <BackToHomeButton />
  <div class="flex-1">
    <div>
      <h1 class="text-4xl font-semibold m-auto bg-white shadow-2xl w-[80%] text-gray-500 py-2 pl-4 mb-10 text-center">
        {category.charAt(0).toUpperCase() + category.slice(1)} Products
      </h1>

      {data.products && data.products.length > 0 ? (
        <ol class="flex flex-wrap gap-3 justify-center">
          {data.products.map((product) => (
            <ProductItem
              key={product.id}
              product={product}
              onAddToCart={onAddToCart}
              formatPrice={formatPrice}
            />
          ))}
        </ol>
      ) : (
        <p>No products available for this category.</p>
      )}
    </div>
  </div>
  <div class="mt-auto">
    <Footer client:only="react" />
  </div>
</div>
